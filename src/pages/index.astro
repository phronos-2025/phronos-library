---
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Nav from '../components/global/Nav.astro';
import Footer from '../components/global/Footer.astro';

const articles = await getCollection('library');
const sortedArticles = articles.sort((a, b) => {
  // Sort by ID number (LIB-001, LIB-002, etc.)
  const aNum = parseInt(a.data.id.replace('LIB-', ''));
  const bNum = parseInt(b.data.id.replace('LIB-', ''));
  return aNum - bNum;
});

const confidenceColors = {
  high: 'var(--success)',
  moderate: 'var(--warning)',
  low: 'var(--alert)',
  mixed: 'var(--gold)'
};
---

<!DOCTYPE html>
<html lang="en">
<head>
  <BaseHead
    title="Phronos Library | Research Synthesis for Cognitive Self-Observation"
    description="A curated synthesis of research on measuring cognitive phenotypes from conversational data. Organized by testable hypotheses with explicit confidence levels."
  />

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Phronos Library",
    "url": "https://phronos.org/library/",
    "description": "Research synthesis for cognitive self-observation"
  }
  </script>

  <style>
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--ink);
      color: var(--white);
      padding: var(--space-sm) var(--space-md);
      z-index: 1000;
      text-decoration: none;
    }

    .skip-link:focus {
      top: 0;
    }

    .page-container {
      max-width: 800px;
      margin: 0 auto;
      padding: var(--space-xl) 5%;
    }

    .page-header {
      margin-bottom: var(--space-xl);
    }

    .section-label {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      font-family: var(--font-mono);
      font-size: var(--text-sm);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--faded);
      margin-bottom: var(--space-md);
    }

    .section-label::before {
      content: '';
      display: block;
      width: 24px;
      height: 2px;
      background: var(--ink);
    }

    h1 {
      margin-bottom: var(--space-md);
    }

    .subtitle {
      font-family: var(--font-body);
      font-size: var(--text-lg);
      color: var(--faded);
      line-height: 1.5;
    }

    .intro {
      background: var(--white);
      border: var(--border-primary);
      padding: var(--space-lg);
      margin-bottom: var(--space-xl);
    }

    .intro p {
      font-family: var(--font-body);
      font-size: var(--text-base);
      margin-bottom: var(--space-md);
    }

    .intro p:last-child {
      margin-bottom: 0;
    }

    .articles-list {
      list-style: none;
      padding: 0;
    }

    .article-card {
      background: var(--white);
      border: var(--border-primary);
      padding: var(--space-lg);
      margin-bottom: var(--space-md);
      transition: transform var(--transition-default), box-shadow var(--transition-default);
    }

    .article-card:hover {
      transform: translate(-2px, -2px);
      box-shadow: 5px 5px 0px rgba(26, 26, 26, 0.1);
    }

    .article-card a {
      text-decoration: none;
      color: inherit;
    }

    .article-card h2 {
      font-family: var(--font-display);
      font-size: var(--text-lg);
      font-weight: 400;
      margin-bottom: var(--space-sm);
      color: var(--ink);
    }

    .article-card .question {
      font-family: var(--font-body);
      font-size: var(--text-base);
      color: var(--faded);
      font-style: italic;
      margin-bottom: var(--space-md);
    }

    .article-meta {
      display: flex;
      gap: var(--space-md);
      font-family: var(--font-mono);
      font-size: var(--text-xs);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--faded);
      align-items: center;
    }

    .confidence-badge {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
      padding: var(--space-xs) var(--space-sm);
      border: 1px solid currentColor;
      font-weight: 500;
    }

    .confidence-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }

    .status-drafting {
      opacity: 0.6;
    }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>
  <Nav currentPage="library" />

  <main id="main-content">
    <div class="page-container">
      <header class="page-header">
        <div class="section-label">Research Synthesis</div>
        <h1>Library</h1>
        <p class="subtitle">A curated synthesis of research relevant to measuring cognitive phenotypes from conversational data.</p>
      </header>

      <div class="intro">
        <p>Each article answers one question and grows incrementally as evidence accumulates.</p>
        <p>Articles are organized by <strong>testable hypotheses</strong> with explicit confidence levels. This is living documentation that tracks what we know, what we don't, and what remains to be tested.</p>
        <p>The Library supports the development of <a href="https://instruments.phronos.org">Instruments</a> for cognitive self-assessment.</p>
      </div>

      <ul class="articles-list">
        {sortedArticles.map((article) => (
          <li class={`article-card ${article.data.status === 'drafting' ? 'status-drafting' : ''}`}>
            <a href={`/library/${article.data.articleSlug}/`}>
              <h2>{article.data.id}: {article.data.title}</h2>
              <p class="question">{article.data.question}</p>
              <div class="article-meta">
                <span class="confidence-badge" style={`color: ${confidenceColors[article.data.confidence]}`}>
                  <span class="confidence-dot" style={`background: ${confidenceColors[article.data.confidence]}`}></span>
                  {article.data.confidence}
                </span>
                <span>{article.data.sources} sources</span>
                <span>{article.data.status}</span>
              </div>
            </a>
          </li>
        ))}
      </ul>
    </div>
  </main>

  <Footer showSubscribe={true} />
</body>
</html>
